<!-- Toggle Handle -->
<button class="toggle-button collapsed" (click)="toggleBar()">
  <span class="icon" [class.active]="isVisible">â˜°</span>
</button>

<div class="container" [class.hidden]="!isVisible">
  <div *ngIf="this.currentViewType === 'Artists'">
    <div class="search-bar">
      <input type="text" placeholder="Search artist" [(ngModel)]="searchTerm" (keyup)="searchArtists()"/>
      <div class="radio-buttons">
        <label><input type="radio" name="searchType" value="artist" checked> Artist</label>
        <label><input type="radio" name="searchType" value="album"> Album</label>
        <label><input type="radio" name="searchType" value="track"> Track</label>
      </div>
    </div>
    <div class="tables-wrapper">
      <cdk-virtual-scroll-viewport itemSize = "48" class="scrollable-table">
        <table>
          <thead>
            <tr>
              <th>Artist</th>
              <th>Scrobbles</th>
            </tr>
          </thead>
          <tbody>
            <!-- Repeated table rows will be generated by Angular *ngFor directive -->
            <tr *cdkVirtualFor="let artist of filteredArtists" 
              draggable="true" (dragstart)="onDragStartArtists($event, artist)"
              (dragover)="onDragOver($event)" (drop)="onDropOnArtistDataset($event)">
              <td *ngIf="this.currentViewType === 'Artists'">{{ artist.name }}</td>
              <td>{{ artist.scrobbles.length }}</td>
            </tr>
          </tbody>
        </table>
      </cdk-virtual-scroll-viewport>
      <div class="combinations-table">
          <table>
            <thead>
              <tr>
                <th>Combinations</th>
                <button (click)="addNewArtistCombo()">Add New Combination</button>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let combo of artistCombos">
                  <!-- Combination Row -->
                  <tr (click)="toggleChildren(combo)" (dragover)="onDragOver($event)" (drop)="onDropOnArtistCombos($event, combo)">
                    <td>
                      <div *ngIf="!combo.isEditing; else editComboNameTemplate" (dblclick)="editComboName(combo)">
                        {{ combo.name || 'New Combination'}}
                      </div>
                      <ng-template #editComboNameTemplate>
                        <input class="combo-name-input" [(ngModel)]="combo.name"
                          (blur)="updateComboName($event, combo)" (keyup.enter)="updateComboName($event, combo)"
                          #comboNameInput/>
                      </ng-template>
                    </td>
                    <td>
                      <button (click)="deleteArtistCombo(combo)">X</button>
                    </td>
                  </tr>
                  <!-- Artist Rows (conditionally displayed) -->
                  <ng-container *ngIf="combo.childrenVisible">
                    <tr *ngFor="let artist of combo.children" draggable="true" (dragstart)="onDragStartBtwnArtistCombos($event, artist, combo)" 
                      (dragover)="onDragOver($event)" (drop)="onDropOnArtistCombos($event, combo)">
                      <td style="padding-left: 40px;">{{ artist.name }}</td>
                      <td>
                        <button (click)="deleteChildFromArtistCombo(artist, combo)">X</button>
                      </td>
                    </tr>
                  </ng-container>
                </ng-container>
            </tbody>
          </table>
      </div>
    </div>
    <div>
      <input type="text" placeholder="Enter New Artist Name" [(ngModel)]="newComboName">
      <!--<button (click)="combineSelected()">Combine Selected Artists</button>-->
      <button (click)="submitArtistCombos()">Submit Combined Artists</button>
    </div>
  </div>
  <div *ngIf="this.currentViewType === 'Albums'">
    <div class="search-bar">
      <input type="text" placeholder="Search artist" [(ngModel)]="searchTerm" (keyup)="searchAlbums()"/>
      <div class="radio-buttons">
        <label><input type="radio" name="searchType" value="artist" checked> Artist</label>
        <label><input type="radio" name="searchType" value="album"> Album</label>
        <label><input type="radio" name="searchType" value="track"> Track</label>
      </div>
    </div>
    <div class="tables-wrapper">
      <cdk-virtual-scroll-viewport itemSize = "48" class="scrollable-table">
        <table>
          <thead>
            <tr>
              <th>Artist</th>
              <th>Album</th>
              <th>Scrobbles</th>
            </tr>
          </thead>
          <tbody>
            <!-- Repeated table rows will be generated by Angular *ngFor directive -->
            <tr *cdkVirtualFor="let album of filteredAlbums" 
              draggable="true" (dragstart)="onDragStartAlbums($event, album)"
              (dragover)="onDragOver($event)" (drop)="onDropOnAlbumDataset($event)">
              <td>{{ album.artistName }}</td>
              <td>{{ album.name }}</td>
              <td>{{ album.scrobbles.length }}</td>
            </tr>
          </tbody>
        </table>
      </cdk-virtual-scroll-viewport>
      <div class="combinations-table">
          <table>
            <thead>
              <tr>
                <th>Combinations</th>
                <button (click)="addNewAlbumCombo()">Add New Combination</button>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let combo of albumCombos">
                  <!-- Combination Row -->
                  <tr (click)="toggleChildren(combo)" (dragover)="onDragOver($event)" (drop)="onDropOnAlbumCombos($event, combo)">
                    <td>
                      <div *ngIf="!combo.isEditing; else editComboNameTemplate" (dblclick)="editComboName(combo)">
                        {{ combo.name || 'New Combination'}}
                      </div>
                      <ng-template #editComboNameTemplate>
                        <input class="combo-name-input" [(ngModel)]="combo.name"
                          (blur)="updateComboName($event, combo)" (keyup.enter)="updateComboName($event, combo)"
                          #comboNameInput/>
                      </ng-template>
                    </td>
                    <td>
                      <button (click)="deleteAlbumCombo(combo)">X</button>
                    </td>
                  </tr>
                  <!-- Artist Rows (conditionally displayed) -->
                  <ng-container *ngIf="combo.childrenVisible">
                    <tr *ngFor="let album of combo.children" draggable="true" (dragstart)="onDragStartBtwnAlbumCombos($event, album, combo)" 
                      (dragover)="onDragOver($event)" (drop)="onDropOnAlbumCombos($event, combo)">
                      <td style="padding-left: 40px;">{{ album.name }}</td>
                      <td>
                        <button (click)="deleteChildFromAlbumCombo(album, combo)">X</button>
                      </td>
                    </tr>
                  </ng-container>
                </ng-container>
            </tbody>
          </table>
      </div>
    </div>
    <div>
      <input type="text" placeholder="Enter New Artist Name" [(ngModel)]="newComboName">
      <!--<button (click)="combineSelected()">Combine Selected Artists</button>-->
      <button (click)="submitAlbumCombos()">Submit Combined Albums</button>
    </div>
  </div>
</div>